name: Deploy to Netlify

on:
  push:
    branches: [ "S19E02-Netlify" ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # RÃ©cupÃ¨re le code du dÃ©pÃ´t (copie notre code dans le runner Ubuntu â†’ git checkout S19E02-gh-pages)
      - name: ğŸ“¥ Checkout du code
        uses: actions/checkout@v4

      # Installation de PNPM
      - name: â¤ï¸ Utilisation de PNPM
        uses: pnpm/action-setup@v4
        with:
          version: 10
          run_install: false

      # PrÃ©pare l'environnement Node
      - name: âš™ï¸ Setup de l'environnement Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 22

      # Installation des dÃ©pendances
      - name: ğŸ“¦ Installation des dÃ©pendances
        run: pnpm install

      # Lancement des tests
      - name: ğŸ§ª Lancement des tests
        run: pnpm test # || echo "âš ï¸ Pas de test trouvÃ© mais le dÃ©ploiement continueâ€¦"

      # Installation de Biome (via l'action officielle)
      # â†’ https://biomejs.dev/recipes/continuous-integration
      - name: ğŸš€ Installer Biome
        uses: biomejs/setup-biome@v2
        with:
          version: latest
      
      # VÃ©rification du code avec Biome AVEC RAPPORT
      - name: ğŸ¨ ExÃ©cuter Biome pour formater et analyser le code
        run: biome ci .
        # run: biome check --apply # permet d'appliquer la correction au lieu de bloquer le dÃ©ploiement

      # Build du projet
      - name: ğŸ—ï¸ Build du projet
        run: pnpm build

      # DÃ©ploiement sur Netlify
      - name: ğŸš€ DÃ©ploiement sur Netlify
        uses: nwtgck/actions-netlify@v3.0
        with:
          publish-dir: './dist'
          production-branch: S19E02-Netlify
          github-token: ${{ secrets.GITHUB_TOKEN }}
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
